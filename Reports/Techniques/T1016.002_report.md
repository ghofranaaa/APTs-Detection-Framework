# Detection Report: T1016.002 - Wi-Fi Discovery

**Technique:** System Network Configuration Discovery: Wi-Fi Discovery

---

## 1. Technique Overview

**Technique ID:** T1016.002  
**Technique Name:** System Network Configuration Discovery: Wi-Fi Discovery  
**Tactic:** Discovery  
**Platform:** Windows

**Description:**  
Adversaries use native Windows commands to discover wireless network configurations and extract saved Wi-Fi credentials from compromised systems. The Windows `netsh` utility allows users to view and manage network settings, including wireless profiles. When used with the `key=clear` parameter, netsh reveals Wi-Fi passwords in plaintext, exposing all networks the victim has previously connected to. Attackers leverage this technique during post-exploitation to gather intelligence about the victim's network environment, steal credentials for lateral movement, and identify additional targets. The extracted information includes network names (SSIDs), authentication types, and most critically, the plaintext passwords for each saved network. This enables attackers to access the victim's home networks, corporate Wi-Fi, or any other networks they've connected to, expanding the attack surface beyond the initially compromised system.

---

## 2. Attack Simulation

**Test Framework:** Atomic Red Team  
**Atomic Test Number:** Test #1  
**Execution Method:** Evil-WinRM from Kali Linux to Windows 10 VM

**Command Executed:**
```cmd
netsh wlan show profile * key=clear
```

**Command Breakdown:**
- `netsh` - Network Shell utility for managing network configurations
- `wlan` - Wireless LAN (Wi-Fi) operations
- `show profile` - Display saved wireless network profiles
- `*` - Wildcard to enumerate ALL saved Wi-Fi networks
- `key=clear` - Extract and display passwords in plaintext format

**Why this is malicious:**  
This command exposes all saved Wi-Fi passwords on the system in plaintext. Attackers use this to steal credentials for networks the victim regularly uses, including home, office, and public Wi-Fi hotspots. With these credentials, attackers can connect to the victim's networks from different locations, maintain persistence even if the initial compromise is remediated, perform man-in-the-middle attacks, or pivot to other devices on those networks. The `key=clear` parameter is rarely used in legitimate scenarios, making its presence a strong indicator of malicious intent.

---

## 3. Detection Configuration

**SIEM Platform:** Elastic Stack (Elasticsearch + Kibana)  
**Data Source:** Sysmon Event ID 1 (Process Creation)  
**Collection Agent:** Winlogbeat  
**Event Channel:** Microsoft-Windows-Sysmon/Operational

**Kibana Detection Rule:**
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "netsh.exe"
AND process.command_line.text: (*wlan* AND *show* AND *profile* AND *key=clear*)
```

**Detection Logic:**
- Monitors Sysmon Event ID 1 for new process creation events
- Filters for netsh.exe execution specifically
- Checks for the presence of all four critical keywords in the command line
- The combination of wlan, show, profile, and especially key=clear indicates credential extraction
- Triggers alert when all conditions match, indicating Wi-Fi password theft

**Why this works:**  
Normal users manage Wi-Fi through the Windows GUI settings, not command-line tools. The netsh command is rarely used outside of advanced troubleshooting scenarios. The `key=clear` parameter is particularly suspicious because it has no legitimate use case for regular users - it exists solely to display passwords in plaintext. When combined with remote execution context (WinRM), this becomes a high-confidence indicator of malicious reconnaissance.

---

## 4. Test Results

**Status:** ✅ Successfully Detected

**Alert Details:**
- **Alert Triggered:** Yes, in Kibana Security Alerts interface
- **Timestamp:** January 25, 2026 @ 22:23:13.803
- **Severity:** High
- **Host:** DESKTOP-K1Q1TJA

**Evidence Collected:**
- **Process Name:** netsh.exe
- **Command Line:** `netsh wlan show profile * key=clear`
- **Parent Process:** cmd.exe (intermediate process from WinRM)
- **Grandparent Process:** wsmprovhost.exe (WinRM provider host)
- **User:** Administrator
- **Execution Context:** Remote execution via Evil-WinRM with High integrity level
- **Working Directory:** `C:\Users\ADMINI~1\AppData\Local\Temp\`
- **Process ID:** 4764

**Observations:**
The process chain wsmprovhost.exe → cmd.exe → netsh.exe confirms remote execution through WinRM, matching our Evil-WinRM attack method. The use of the wildcard (`*`) indicates the attacker attempted to extract passwords for ALL saved networks, not just a specific one. The `key=clear` parameter is the critical indicator - this parameter serves no purpose other than to expose plaintext passwords. The execution from the TEMP directory working path is also consistent with remote command execution patterns.

---

## 5. Sigma Rule Effectiveness

**Rule Performance:** Effective  
**Alert Accuracy:** True Positive

**Strengths:**
- Successfully detected Wi-Fi credential extraction attempt
- The `key=clear` parameter provides high-confidence detection with minimal false positives
- Full command-line visibility captured all critical indicators
- Simple rule logic focused on the most dangerous variant of the technique
- Process chain visible for complete attack context

---

## 6. False Positive Analysis

**Potential False Positives:**

1. **IT Support Troubleshooting**
   - Helpdesk staff diagnosing Wi-Fi connectivity issues
   - Network administrators documenting network configurations
   - Very rare in normal operations

2. **Network Audit Scripts**
   - Security teams inventorying saved wireless profiles
   - Compliance checks for Wi-Fi security policies
   - Should be traceable to authorized security tools

3. **System Migration Tools**
   - Backup/restore utilities capturing Wi-Fi settings
   - Profile migration during system upgrades
   - Typically part of documented change management

**Likelihood:** Very Low

**Mitigation Strategies:**
- Whitelist known security audit tools by process hash or path
- Exclude authorized IT support accounts during documented maintenance
- Baseline legitimate netsh usage over 2-4 weeks
- Focus on remote execution context (WinRM/RDP) as primary indicator
- Alert on any usage of `key=clear` parameter regardless of context

---

## 7. Conclusion

The Sigma rule successfully detected T1016.002 Wi-Fi Discovery through netsh credential extraction. The detection captured the complete attack including remote execution context and the critical `key=clear` parameter that exposes plaintext passwords.

---

## References

- MITRE ATT&CK T1016.002: https://attack.mitre.org/techniques/T1016/002/
- Atomic Red Team: https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.002.md