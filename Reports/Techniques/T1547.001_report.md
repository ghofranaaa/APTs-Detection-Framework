# Detection Report: T1547.001 – Registry Run Keys / Startup Folder

**Technique:** Boot or Logon Autostart Execution

---

## 1. Technique Overview

**Technique ID:** T1547.001
**Technique Name:** Registry Run Keys / Startup Folder
**Tactic:** Persistence
**Platform:** Windows

**Description:**  
This technique enables adversaries to maintain persistent execution by configuring programs to run automatically when a user logs on. Registry Run keys are particularly attractive because they rely on built-in Windows behavior and can be modified using native utilities such as reg.exe.

---

## 2. Attack Simulation

**Test Framework:** Atomic Red Team  
**Atomic Test Number:** Test #1
**Execution Method:** Evil-WinRM from Kali Linux to Windows 10 VM

**Command Executed:**
```  REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /t REG_SZ /F /D "C:\Path\AtomicRedTeam.exe"
```

**Command Breakdown:**
- `reg.exe` - Native Windows registry modification utility
- `HKCU\...\Run` - User-level persistence registry key
- `Atomic Red Team` - Registry value name
- `C:\Path\AtomicRedTeam.exe` - Payload configured for autostart

**Why this is malicious:**  
Although registry modifications are common, manually adding executables to Run keys is a well-known persistence technique. When combined with unusual executable paths or post-exploitation activity, this behavior strongly indicates malicious intent.

---

## 3. Detection Configuration

**SIEM Platform:** Elastic Stack (Elasticsearch + Kibana)  
**Data Source:** Sysmon Event ID 1 (Process Creation)  
**Collection Agent:** Winlogbeat  
**Event Channel:** Microsoft-Windows-Sysmon/Operational

**Kibana Detection Rule:**
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "reg.exe"
AND process.command_line.text: "*CurrentVersion\\Run*"
AND process.command_line.text: "*REG ADD*"
```

**Detection Logic:**
- Monitors Sysmon Event ID 1 for new process creation events
- Filters for reg.exe execution specifically
- Detects REG ADD command indicating registry modification
- Identifies modifications to CurrentVersion\Run registry path
- Triggers alert when registry persistence mechanism is being established

**Why this works:**  
The execution of reg.exe to add values under Run keys is infrequent during normal user activity. Monitoring this behavior provides high visibility into persistence attempts that rely on registry-based autostart mechanisms.

---

## 4. Test Results

**Status:** ✅ Successfully Detected

**Alert Details:**
- **Alert Triggered:** Yes, in Kibana Security Alerts interface
- **Timestamp:** Jan 26, 2026 @ 18:01:19.917
- **Severity:** Medium
- **Host:** DESKTOP-K1Q1TJA

**Evidence Collected:**
- **Process Name:** reg.exe
- **Command Line:** `REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /D "C:\Path\AtomicRedTeam.exe"`
- **Parent Process:** cmd.exe
- **User:** Administrator
- **integrity level:** High
- **Destination Directory:** `%TEMP%`
- **Process ID:** 2348

**Observations:**
The detection captured the registry modification via reg.exe targeting the Run key for persistence. The parent process cmd.exe and TEMP working directory indicate remote execution via Evil-WinRM. High integrity level confirms Administrator privileges were used. 

---

## 5. Sigma Rule Effectiveness

**Rule Performance:** Effective  
**Alert Accuracy:** True Positive

**Strengths:**
- Detects native Windows persistence abuse
- EClear MITRE mapping
- Strong post-exploitation signal

---

## 6. False Positive Analysis

**Potential False Positives:**

1. **Legitimate software installers**

2. **Administrative startup scripts**

3. **Enterprise endpoint management tools**

**Likelihood:** Medium

**Mitigation Strategies:**
- Allowlist known software vendors
- Correlate with suspicious parent processes
- Monitor unusual executable paths (Temp, AppData)

---

## 7. Conclusion

This detection reliably identifies registry-based persistence via Run keys. By focusing on reg.exe process creation and command-line context, the rule provides high-confidence visibility into a commonly abused persistence mechanism while maintaining manageable false positive rates.

---

## References

- MITRE ATT&CK T1033: https://attack.mitre.org/techniques/T1574/001
- Atomic Red Team: https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.001/T1547.001.md