# Detection Report: T1546.001 - Change Default File Association

**Technique:** Event Triggered Execution: Change Default File Association  

---

## 1. Technique Overview

**Technique ID:** T1546.001  
**Technique Name:** Event Triggered Execution: Change Default File Association  
**Tactic:** Persistence 
**Platform:** Windows

**Description:**  
This technique involves adversaries modifying file associations to execute malicious code whenever a specific file type is opened. By changing the default program associated with a file extension, attackers can achieve persistence and execute arbitrary commands each time a user opens that file type. For example, an attacker could modify the `.txt` file association to launch a malicious executable instead of Notepad whenever a text file is opened.

---

## 2. Attack Simulation

**Test Framework:** Atomic Red Team  
**Atomic Test Number:** Test #1  
**Execution Method:** Evil-WinRM from Kali Linux to Windows 10 VM

**Command Executed:**
```cmd
assoc .hta=htafile
```

**Command Breakdown:**
- `assoc` - Windows command that associates a file extension with a file type
- `.hta=htafile` - Changes the default handler for `.hta` extension to `htafile` type
- When combined with `ftype`, this allows execution of arbitrary programs when `.hta` files are opened

**Why this is malicious:**  
Attackers can use this to redirect common file types to malicious executables, achieving persistence. Every time a user opens the affected file type, the malicious program runs automatically.

---

## 3. Detection Configuration

**SIEM Platform:** Elastic Stack (Elasticsearch + Kibana)  
**Data Source:** Sysmon Event ID 1 (Process Creation)  
**Collection Agent:** Winlogbeat  
**Event Channel:** Microsoft-Windows-Sysmon/Operational

**Kibana Detection Rule:**
```kql
winlog.channel : "Microsoft-Windows-Sysmon/Operational" 
and event.code : "1" 
and process.name : "cmd.exe" 
and process.command_line.text : "*assoc*" 
and process.command_line.text : "*.hta*"
```

**Detection Logic:**
- Monitors Sysmon Event ID 1 for process creation events
- Filters for `cmd.exe` processes
- Looks for command lines containing both "assoc" and ".hta"
- Triggers alert when all conditions are met

**Why this works:**  
The `assoc` command is rarely used by normal users. Detecting its usage, especially targeting specific extensions like `.hta`, provides high-confidence indicators of persistence attempts.

---

## 4. Test Results

**Status:** âœ… Successfully Detected

**Alert Details:**
- **Alert Triggered:** Yes, in Kibana Security Alerts interface
- **Timestamp:** January 23, 2026 @ 20:01:12.556
- **Severity:** High
- **Host:** Administrator

**Evidence Collected:**
- **Process Name:** cmd.exe
- **Command Line:** `"cmd.exe" /c assoc .hta=htafile`
- **Parent Process:** wsmprovhost.exe (WinRM host process)
- **User:** Administrator
- **Execution Context:** Remote execution via Evil-WinRM

**Observations:**
The parent process `wsmprovhost.exe` indicates remote execution through WinRM, which aligns with our Evil-WinRM attack method. The full command line was captured, providing clear evidence of file association manipulation.

---

## 5. Sigma Rule Effectiveness

**Rule Performance:** Effective  
**Alert Accuracy:** True Positive

**Strengths:**
- Successfully detected the persistence technique
- Full command-line visibility enables investigation
- Low false positive rate for `.hta` file extension monitoring
- Simple rule logic makes it easy to maintain

---

## 6. False Positive Analysis

**Potential False Positives:**

1. **System Administration**
   - IT staff configuring file associations for deployment
   - Rare but possible in enterprise environments

2. **Legacy Application Configuration**
   - Older software that modifies file associations during installation
   - Usually happens during software deployment

**Likelihood:** Low to Medium

**Mitigation Strategies:**
- Baseline normal `assoc` usage over 2-4 weeks
- Whitelist known administrative scripts
- Focus on suspicious extensions (`.hta`, `.exe`, `.bat`)
- Correlate with other indicators (suspicious parent processes, unusual users)

---

## 7. Conclusion

The Sigma rule successfully detected T1546.001 file association manipulation via the `assoc` command. The detection provided full visibility into the attack, capturing the complete command line and execution context. 
---

## References

- MITRE ATT&CK T1546.001: https://attack.mitre.org/techniques/T1546/001/
- Atomic Red Team: https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.001/T1546.001.md