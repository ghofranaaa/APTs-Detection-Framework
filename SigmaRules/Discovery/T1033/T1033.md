# T1033 – System Owner/User Discovery

## Technique Description

**MITRE ATT&CK ID:** T1033 
**Tactic:** Discovery 
**Platform:** Windows

Adversaries use System Owner/User Discovery to identify the current user context, enumerate local or domain accounts, and identify active or disconnected user sessions on a compromised system. This information allows attackers to understand privilege levels, determine whether the system is actively monitored, and select suitable targets for credential access, lateral movement, or persistence.

On Windows systems, this discovery is commonly performed using native command-line utilities such as `whoami`, `wmic`, `quser`, and `qwinsta`. Because these tools are built into the operating system and frequently used by administrators, their execution blends in with legitimate activity and reduces the likelihood of immediate detection.

**Real-World Usage:**  
The theat actors **APT28** have been observed performing user and session discovery during early post-exploitation phases to assess access level and identify high-value accounts before advancing their operations.

---

## Atomic Red Team Test

**Test Number:** Test #1  
**Supported Platforms:** Windows

### Test Command
```
cmd.exe /C whoami
wmic useraccount get /ALL
quser /SERVER:"#{computer_name}"
quser
qwinsta.exe /server:#{computer_name}
qwinsta.exe
for /F "tokens=1,2" %i in ('qwinsta /server:#{computer_name} ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > computers.txt
@FOR /F %n in (computers.txt) DO @FOR /F "tokens=1,2" %i in ('qwinsta /server:%n ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > usernames.txt
```

**Parameters:**
- `whoami` - Displays the current user context

- `wmic useraccount get /ALL` - Enumerates local user accounts

- `quser` - Lists logged-on users and session statesvisibility

- `qwinsta` - Displays session and terminal information

### Expected Behavior
When executed, these commands enumerate the current user identity, local user accounts, and active or disconnected sessions on the system. This provides the attacker with critical situational awareness, including whether the session is administrative, whether other users are logged in, and whether the system is suitable for further interaction or lateral movement.

---

## Sigma Rule

```yaml
title: System Owner and User Discovery via Command Line
id: 4c8a9b77-t1033-user-discovery
status: experimental
description: Detects cmd.exe writing and reading files in TEMP directory via remote execution
references:
    - https://attack.mitre.org/techniques/T1033
    - https://github.com/redcanaryco/atomic-red-team
author: Ghofrane Amemi
date: 2026-01-26
tags:
  - attack.execution
  - attack.t1033
  - atomic_red_team

logsource:
  product: windows
  category: process_creation
  service: sysmon

detection:
  selection_cmd:
    Image|endswith: '\cmd.exe'
    CommandLine|contains|all:
      - 'whoami'
      - 'quser'
      - 'wmic useraccount'
      - 'qinsta'

  condition: selection_cmd

falsepositives:
  - Legitimate system administration
  - Helpdesk or troubleshooting activity
  - IT inventory scripts

level: medium
```
---

## Kibana Detection Query

**Rule Name:** T1033 – System Owner/User Discovery 
**Severity:** Medium

### KQL Query
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "cmd.exe"
AND (
process.command_line.text: "*whoami*"
OR process.command_line.text: "*wmic useraccount*"
OR process.command_line.text: "*quser*"
OR process.command_line.text: "*qwinsta*"
)
```

### Required Data Sources
- **Log Source:** Sysmon
- **Event ID:** 1 (Process Creation)
- **Channel:** Microsoft-Windows-Sysmon/Operational

---

## Limitations

This detection focuses on command-line–based user discovery and will not detect:
- API-based user enumeration
- PowerShell-based discovery (Get-LocalUser, Get-WmiObject)
- Legitimate administrative activity without additional context