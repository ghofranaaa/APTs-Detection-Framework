# T1112 - Modify Registry

## Technique Description

**MITRE ATT&CK ID:** T1112 
**Tactic:** Defense Evasion  
**Platform:** Windows

Adversaries modify the Windows Registry to hide files, weaken security controls, alter system behavior, or establish stealthy persistence mechanisms. The registry stores critical configuration data for the operating system and user environment, making it a high-value target for attackers. By changing registry values, adversaries can evade detection, disable security features, conceal malicious artifacts, and influence how the operating system presents files and executes programs.

A common abuse of this technique involves modifying Explorer settings to hide file extensions. By enabling the HideFileExt registry value, attackers can disguise malicious files (e.g., document.pdf.exe) as benign documents, increasing the likelihood of user execution and reducing detection by defenders.

**Real-World Usage:**  
This technique has been widely used by **APT28** to evade user awareness and security monitoring by disguising malware payloads and manipulating system behavior during post-exploitation phases.

---

## Atomic Red Team Test

**Test Number:** Test #1  
**Supported Platforms:** Windows

### Test Command
```reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /t REG_DWORD /v HideFileExt /d 1 /f
```

**Parameters:**
- `reg add` - Windows Registry modification utility

- `HKEY_CURRENT_USER\...\Explorer\Advanced` - Explorer configuration key

- `/v HideFileExt` -  Registry value that controls file extension visibility

- `/d 1` -  Enables hiding file extensions

- `/f` -  Forces overwrite without confirmation

### Expected Behavior
When executed, this command modifies the registry to hide file extensions for known file types in Windows Explorer. This allows attackers to disguise executable payloads as harmless documents or images, facilitating social engineering and malware execution. The change persists across sessions and affects how files are displayed to the user, directly supporting defense evasion objectives.

---

## Sigma Rule

```yaml
title: Registry Modification to Hide File Extensions
id: 9b71c1e2-t1112-hidefileext
status: experimental
description: >
  Detects modification of Windows Explorer registry settings to hide file extensions,
  a common defense evasion technique used to disguise malicious files (T1112).
references:
  - https://attack.mitre.org/techniques/T1112
  - https://github.com/redcanaryco/atomic-red-team
author: Ghofrane Amemi
date: 2026-01-25
tags:
  - attack.defense_evasion
  - attack.t1112
  - atomic_red_team

logsource:
  product: windows
  category: process_creation
  service: sysmon

detection:
  selection_reg:
    Image|endswith: '\reg.exe'
    CommandLine|contains|all:
      - 'add'
      - 'HideFileExt'
  selection_parent:
    ParentImage|endswith: '\cmd.exe'


  condition: selection_reg and selection_parent

falsepositives:
  - User preference changes via command line
  - Legitimate system hardening scripts

level: high
```
---

## Kibana Detection Query

**Rule Name:** T1016.002 - Wi-Fi Password Extraction via Netsh  
**Severity:** High

### KQL Query
```kql
winlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "reg.exe"
AND process.command_line.text: (*HideFileExt* AND *add*)
```

### Required Data Sources
- **Log Source:** Sysmon
- **Event ID:** 1 (Process Creation)
- **Channel:** Microsoft-Windows-Sysmon/Operational

---

## Limitations

This detection focuses on command-line registry modifications using reg.exe. It will not detect:
- Registry changes made via GUI (Explorer Options)
- PowerShell-based registry modifications
- Direct API calls modifying the registry
- Group Policyâ€“driven changes
- Registry edits performed by trusted installers

The rule is optimized for detecting attacker-driven registry manipulation during post-exploitation phases.